### This is a customized httpd.conf file for dante wiki.



# ServerName gives the name and port that the server uses to identify itself.
ServerName localhost


# TODO: change this when going operational
# See also https://serverfault.com/questions/793494/various-config-variables-not-defined-apache-2-4-18
# Should also use the starting script of apache according to https://serverfault.com/questions/900009/undefined-variables-in-etc-apache2-apache2-conf



### Security hardening of Apache
ServerTokens Prod
ServerSignature Off
TraceEnable off


# email on some server-generated pages, such as error documents
ServerAdmin office@unagon.com

ServerRoot /var/www

Listen 80



LoadModule authn_file_module modules/mod_authn_file.so


LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_user_module modules/mod_authz_user.so


LoadModule authz_core_module modules/mod_authz_core.so
LoadModule access_compat_module modules/mod_access_compat.so
LoadModule auth_basic_module modules/mod_auth_basic.so


#LoadModule macro_module modules/mod_macro.so
#LoadModule dbd_module modules/mod_dbd.so

#LoadModule data_module modules/mod_data.so

LoadModule reqtimeout_module modules/mod_reqtimeout.so

LoadModule filter_module modules/mod_filter.so

LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so

LoadModule env_module modules/mod_env.so

##
## allow modification of headers
##
LoadModule headers_module modules/mod_headers.so

# Sample Cache Configuration
LoadModule cache_module modules/mod_cache.so
<IfModule mod_cache.c>
    LoadModule cache_disk_module modules/mod_cache_disk.so
    <IfModule mod_cache_disk.c>
        CacheRoot "/tmp"
        CacheEnable disk  "/"
        CacheDirLevels 5
        CacheDirLength 3
    </IfModule>
</IfModule>


##
## http version 2
##
LoadModule http2_module modules/mod_http2.so
Protocols h2 http/1.1
LogLevel http2:info



<IfModule !mpm_prefork_module>
    #LoadModule cgid_module modules/mod_cgid.so
</IfModule>
<IfModule mpm_prefork_module>
    #LoadModule cgi_module modules/mod_cgi.so
</IfModule>



LoadModule alias_module modules/mod_alias.so

LoadModule negotiation_module modules/mod_negotiation.so

##
## Run under proper user and group
##
LoadModule unixd_module modules/mod_unixd.so
User apache
Group apache



# 'Main' server configuration
#
# The directives in this section set up the values used by the 'main'
# server, which responds to any requests that aren't handled by a
# <VirtualHost> definition.  These values also provide defaults for
# any <VirtualHost> containers you may define later in the file.
#
# All of these directives may appear inside <VirtualHost> containers,
# in which case these default settings will be overridden for the
# virtual host being defined.
#




# Deny access to the server filesystem root. 
<Directory />
  AllowOverride none
  Require all denied
</Directory>


# DocumentRoot: The directory out of which we will serve documents 
DocumentRoot "/var/www/html"


<Directory "/var/www/html">

# For options:  http://httpd.apache.org/docs/2.4/mod/core.html#options
  Options FollowSymLinks

 # Disable .htaccess  
  AllowOverride None

  Require all granted
</Directory>

# Prevent .htaccess and .htpasswd files from being viewed 
<Files ".ht*">
    Require all denied
</Files>

#
# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog logs/error.log


### LogLevel: : debug, info, notice, warn, error, crit, alert, emerg.
LogLevel warn


<IfModule log_config_module>
    #
    # The following directives define some format nicknames for use with
    # a CustomLog directive (see below).
    #
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a <VirtualHost>
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-<VirtualHost> access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    #CustomLog logs/access.log common

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    CustomLog logs/access.log combined
</IfModule>


<IfModule headers_module>
    #
    # Avoid passing HTTP_PROXY environment to CGI's on this or any proxied
    # backend servers which have lingering "httpoxy" defects.
    # 'Proxy' request header is undefined by the IETF, not listed by IANA
    #
    RequestHeader unset Proxy early
</IfModule>


<IfModule mime_module>
    TypesConfig /etc/apache2/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
</IfModule>


#
# MaxRanges: Maximum number of Ranges in a request before
# returning the entire resource, or one of the special
# values 'default', 'none' or 'unlimited'.
# Default setting is to accept 200 Ranges.
#MaxRanges unlimited


# EnableMMAP use memory-mapping to deliver files
# Must be turned off when serving from networked-mounted filesystem
EnableMMAP off


#
# Add Apache module definitions as necessary for Mediawiki
#
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so




# Load additional config files from the config directory "/etc/apache2/conf.d"
# NOTE: We do not load the entire directory but do a more specific manual control. This is a docker image anyhow
#       and we will not use the usual day-to-day admin things

IncludeOptional /etc/apache2/conf.d/default.conf

IncludeOptional /etc/apache2/conf.d/info.conf
IncludeOptional /etc/apache2/conf.d/languages.conf



IncludeOptional /etc/apache2/conf.d/mediawiki-alpine-lamp-apache2.conf
IncludeOptional /etc/apache2/conf.d/mpm.conf



# Fix https://bugs.centos.org/view.php?id=17332 due to a buggy proxy.conf
# Do not include proxy.conf

LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule watchdog_module modules/mod_watchdog.so
LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so
LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so
LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule proxy_express_module modules/mod_proxy_express.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
LoadModule proxy_fdpass_module modules/mod_proxy_fdpass.so
LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_scgi_module modules/mod_proxy_scgi.so
LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so


IncludeOptional /etc/apache2/conf.d/ssl.conf
























